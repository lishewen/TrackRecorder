<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:ios="clr-namespace:Microsoft.Maui.Controls.PlatformConfiguration.iOSSpecific;assembly=Microsoft.Maui.Controls"
             x:Class="TrackRecorder.MainPage"
             Title="轨迹记录器">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">
            <!-- 状态信息卡片 -->
            <Border Stroke="#CCCCCC" StrokeThickness="1" 
                    StrokeShape="RoundRectangle 10" 
                    Background="#F8F8F8" Padding="15">
                <VerticalStackLayout Spacing="8">
                    <Label Text="📊 状态信息" FontAttributes="Bold" FontSize="16" TextColor="#333333" />
                    <Label x:Name="StatusLabel" Text="未开始记录" FontSize="16" TextColor="#2196F3" />
                    <Label x:Name="PointCountLabel" Text="记录点数: 0" TextColor="#666666" />
                    <Label x:Name="DistanceLabel" Text="距离: 0.00 km" TextColor="#666666" />
                    <Label x:Name="DurationLabel" Text="时长: 00:00:00" TextColor="#666666" />
                </VerticalStackLayout>
                <Border.Shadow>
                    <Shadow Brush="#000000" Opacity="0.1" Radius="5" Offset="2,2" />
                </Border.Shadow>
            </Border>
            
            <!-- 服务状态卡片 -->
            <Border Stroke="#2196F3" StrokeThickness="1" 
                    StrokeShape="RoundRectangle 10" 
                    Background="#E3F2FD" Padding="15">
                <VerticalStackLayout Spacing="8">
                    <Label Text="🔧 服务状态" FontAttributes="Bold" FontSize="16" TextColor="#1976D2" />
                    <Label x:Name="ServiceStatusLabel" Text="服务未运行" FontSize="16" TextColor="#D32F2F" />
                    <ProgressBar x:Name="ServiceProgressBar" IsVisible="False" Progress="0.3" 
                                 ProgressColor="#2196F3" HeightRequest="4" />
                    <Label x:Name="ServiceStatusMessage" Text="等待启动服务..." TextColor="#666666" FontSize="14" />
                </VerticalStackLayout>
                <Border.Shadow>
                    <Shadow Brush="#000000" Opacity="0.08" Radius="5" Offset="2,2" />
                </Border.Shadow>
            </Border>

            <!-- 控制按钮组 -->
            <Border Stroke="#CCCCCC" StrokeThickness="1" 
                    StrokeShape="RoundRectangle 10" 
                    Background="#F8F8F8" Padding="15">
                <VerticalStackLayout Spacing="10">
                    <Label Text="🎮 服务控制" FontAttributes="Bold" FontSize="16" TextColor="#333333" />

                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
                        <Button x:Name="StartServiceButton" Text="🚀 启动服务" Clicked="OnStartServiceClicked" 
                                BackgroundColor="#4CAF50" TextColor="White" 
                                CornerRadius="8" FontAttributes="Bold" Grid.Column="0" />
                        <Button x:Name="PauseServiceButton" Text="⏸️ 暂停服务" Clicked="OnPauseServiceClicked" 
                                BackgroundColor="#FFA726" TextColor="White" 
                                CornerRadius="8" FontAttributes="Bold" IsEnabled="False" Grid.Column="1" />
                        <Button x:Name="StopServiceButton" Text="⏹️ 停止服务" Clicked="OnStopServiceClicked" 
                                BackgroundColor="#F44336" TextColor="White" 
                                CornerRadius="8" FontAttributes="Bold" IsEnabled="False" Grid.Column="2" />
                    </Grid>

                    <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                        <Button x:Name="CheckPermissionsButton" Text="🔐 检查权限" Clicked="OnCheckPermissionsClicked" 
                                BackgroundColor="#9C27B0" TextColor="White" 
                                CornerRadius="8" FontAttributes="Bold" />
                        <Button x:Name="CheckLocationButton" Text="📍 检查位置" Clicked="OnCheckLocationClicked" 
                                BackgroundColor="#3F51B5" TextColor="White" 
                                CornerRadius="8" FontAttributes="Bold" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
                <Border.Shadow>
                    <Shadow Brush="#000000" Opacity="0.1" Radius="5" Offset="2,2" />
                </Border.Shadow>
            </Border>
            
            <!-- 控制按钮组 -->
            <Border Stroke="#CCCCCC" StrokeThickness="1" 
                    StrokeShape="RoundRectangle 10" 
                    Background="#F8F8F8" Padding="15">
                <VerticalStackLayout Spacing="10">
                    <Label Text="🎮 控制面板" FontAttributes="Bold" FontSize="16" TextColor="#333333" />

                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
                        <Button x:Name="StartButton" Text="▶️ 开始" Clicked="OnStartClicked" 
                                BackgroundColor="#4CAF50" TextColor="White" 
                                CornerRadius="8" FontAttributes="Bold" Grid.Column="0" />
                        <Button x:Name="PauseButton" Text="⏸️ 暂停" Clicked="OnPauseClicked" 
                                BackgroundColor="#FFA726" TextColor="White" 
                                CornerRadius="8" FontAttributes="Bold" IsEnabled="False" Grid.Column="1" />
                        <Button x:Name="StopButton" Text="⏹️ 停止" Clicked="OnStopClicked" 
                                BackgroundColor="#F44336" TextColor="White" 
                                CornerRadius="8" FontAttributes="Bold" IsEnabled="False" Grid.Column="2" />
                    </Grid>

                    <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                        <Button x:Name="ExportButton" Text="📤 导出GPX" Clicked="OnExportClicked" 
                                BackgroundColor="#2196F3" TextColor="White" 
                                CornerRadius="8" FontAttributes="Bold" IsEnabled="False" />
                        <Button x:Name="ClearButton" Text="🗑️ 清除" Clicked="OnClearClicked" 
                                BackgroundColor="#9E9E9E" TextColor="White" 
                                CornerRadius="8" FontAttributes="Bold" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
                <Border.Shadow>
                    <Shadow Brush="#000000" Opacity="0.1" Radius="5" Offset="2,2" />
                </Border.Shadow>
            </Border>

            <!-- 新增：文件管理按钮组 -->
            <Border Stroke="#2196F3" StrokeThickness="1" 
                    StrokeShape="RoundRectangle 10" 
                    Background="#E3F2FD" Padding="15">
                <VerticalStackLayout Spacing="10">
                    <Label Text="📁 文件管理" FontAttributes="Bold" FontSize="16" TextColor="#1976D2" />
                    <Label Text="查看、管理已保存的GPX轨迹文件" TextColor="#666666" FontSize="14" />
                    <Button Text="📂 打开文件管理" Clicked="OnFileManagementClicked" 
                            BackgroundColor="#1976D2" TextColor="White" 
                            CornerRadius="8" FontAttributes="Bold" 
                            HorizontalOptions="Fill" />
                </VerticalStackLayout>
                <Border.Shadow>
                    <Shadow Brush="#000000" Opacity="0.08" Radius="5" Offset="2,2" />
                </Border.Shadow>
            </Border>
            
            <!-- 位置信息卡片 -->
            <Border Stroke="#CCCCCC" StrokeThickness="1" 
                    StrokeShape="RoundRectangle 10" 
                    Background="#F8F8F8" Padding="15">
                <VerticalStackLayout Spacing="8">
                    <Label Text="📍 位置信息" FontAttributes="Bold" FontSize="16" TextColor="#333333" />
                    <Label x:Name="LocationLabel" Text="等待位置更新..." TextColor="#666666" LineBreakMode="WordWrap" />
                    <Label x:Name="SpeedLabel" Text="速度: 0.0 km/h" TextColor="#666666" />
                    <Label x:Name="AltitudeLabel" Text="海拔: 0.0 m" TextColor="#666666" />
                    <Label x:Name="AccuracyLabel" Text="精度: 0.0 m" TextColor="#666666" />
                </VerticalStackLayout>
                <Border.Shadow>
                    <Shadow Brush="#000000" Opacity="0.1" Radius="5" Offset="2,2" />
                </Border.Shadow>
            </Border>

            <!-- 轨迹统计卡片 -->
            <Border Stroke="#CCCCCC" StrokeThickness="1" 
                    StrokeShape="RoundRectangle 10" 
                    Background="#F8F8F8" Padding="15">
                <VerticalStackLayout Spacing="8">
                    <Label Text="📈 轨迹统计" FontAttributes="Bold" FontSize="16" TextColor="#333333" />
                    <Label x:Name="MaxSpeedLabel" Text="最高速度: 0.0 km/h" TextColor="#666666" />
                    <Label x:Name="AverageSpeedLabel" Text="平均速度: 0.0 km/h" TextColor="#666666" />
                    <Label x:Name="StartTimeLabel" Text="开始时间: --" TextColor="#666666" />
                    <Label x:Name="EndTimeLabel" Text="结束时间: --" TextColor="#666666" />
                </VerticalStackLayout>
                <Border.Shadow>
                    <Shadow Brush="#000000" Opacity="0.1" Radius="5" Offset="2,2" />
                </Border.Shadow>
            </Border>
            
            <!-- 快捷操作区 -->
            <Border Stroke="#8BC34A" StrokeThickness="1" 
                    StrokeShape="RoundRectangle 10" 
                    Background="#F1F8E9" Padding="15">
                <VerticalStackLayout Spacing="10">
                    <Label Text="⚡ 快捷操作" FontAttributes="Bold" FontSize="16" TextColor="#33691E" />
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10" RowSpacing="10">
                        <Button Text="🔄 刷新数据" Clicked="OnRefreshClicked" 
                                BackgroundColor="#4CAF50" TextColor="White" 
                                CornerRadius="8" Grid.Column="0" Grid.Row="0" />
                        <Button Text="📱 应用设置" Clicked="OnSettingsClicked" 
                                BackgroundColor="#FF9800" TextColor="White" 
                                CornerRadius="8" Grid.Column="1" Grid.Row="0" />
                        <Button Text="📊 统计图表" Clicked="OnStatisticsClicked" 
                                BackgroundColor="#9C27B0" TextColor="White" 
                                CornerRadius="8" Grid.Column="0" Grid.Row="1" />
                        <Button Text="🌐 在线同步" Clicked="OnSyncClicked" 
                                BackgroundColor="#3F51B5" TextColor="White" 
                                CornerRadius="8" Grid.Column="1" Grid.Row="1"
                                IsEnabled="False" Opacity="0.7" />
                    </Grid>
                </VerticalStackLayout>
                <Border.Shadow>
                    <Shadow Brush="#000000" Opacity="0.08" Radius="5" Offset="2,2" />
                </Border.Shadow>
            </Border>
            
            <!-- 提示信息 -->
            <Border Stroke="#FFC107" StrokeThickness="1" 
                    StrokeShape="RoundRectangle 8" 
                    Background="#FFF8E1" Padding="15" Margin="0,10,0,0">
                <Label Text="💡 提示: 此应用需要后台位置权限才能持续记录轨迹。为了获得最佳效果，请保持应用在前台或使用通知栏服务。" 
                       TextColor="#795548" LineBreakMode="WordWrap" />
            </Border>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>